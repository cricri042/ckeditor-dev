<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<base href="">
	</head>
	<body>
		<script>
		var doc = document,
			baseHref;

		// Retrieving custom domain (if any) from url query part. We assume that only
		// domain variable is passed so there's hardcoded offset for var value.
		if ( location.search ) {
			var matchResult;

			// Looking for base address in url query part (if present).
			if ( ( matchResult = location.search.match( /(?:[\?&]base=)(.+?)(?=&|#|$)/ ) ) )
				baseHref = decodeURIComponent( matchResult[ 1 ] );

			// Looking for domain in url query part (if present).
			if ( ( matchResult = location.search.match( /(?:[\?&]domain=)(.+?)(?=&|#|$)/ ) ) )
				doc.domain = decodeURIComponent( matchResult[ 1 ] );
		}

		// If custom base addr was sent.
		if ( baseHref )
			doc.getElementsByTagName( 'base' )[ 0 ].setAttribute( 'href', baseHref );

		doc.open();
		doc.write( window.opener._cke_htmlToLoad );
		doc.close();

		// Fix for anchors.
		var links = document.querySelectorAll( 'a[href^="#"]' );

		for ( var i = links.length - 1; i >= 0; i-- ) {
			var curLink = links.item( i );
			curLink.setAttribute( 'href', location.origin + location.pathname + location.search + curLink.getAttribute( 'href' ) );
		}
		</script>
	</body>
</html>